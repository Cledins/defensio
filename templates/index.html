<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <title>Defensio</title>
</head>

    <body class="bg-gray-200">
        <div id="flex-container-1" class="flex-container">
                <!-- Logo en haut à gauche -->
                <img src="/static/logo.png" alt="Votre Logo" class="w-12 h-12">
                <!-- Numéro du groupe en haut à droite -->
                <div id="numberDisplay" class="text-xl font-bold"></div>
           
        </div>
    </div>

    <div id="flex-container-2" class="flex-container">
        <!-- Jauges -->    
        <div>
            <img src="/static/C.png" alt="Jauge C">
            <div id="JaugeC">JaugeC</div>
        </div>
        <div>
            <img src="/static/R.png" alt="Jauge R">
            <div id="JaugeR">JaugeR</div>
        </div>
        <div>
            <img src="/static/I.png" alt="Jauge I">
            <div id="JaugeI">JaugeI</div>
        </div>
    </div>
    

    <div id="flex-container-3" class="flex-container">
        <div id="card-container" class="flex-container">
        </div>

        <div class="additional-containers">
            <!-- Additional flex containers (4 in this example) -->
            <div class="additional-container">Défense feu</div>
            <div class="additional-container">Défense terre</div>
            <div class="additional-container">Défense air</div>
            <div class="additional-container">Défense eau</div>
        </div>
    </div>

    <script>
        function getCookie(name) {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookie = cookies[i].trim();
            if (cookie.indexOf(name + "=") === 0) {
            return cookie.substring(name.length + 1);
            }
        }
        return "";
        };

        var storedNumber = getCookie("number");
        $("#numberDisplay").text("Équipe "+storedNumber);
    </script>
   
   <script>
    
    // Initialize the variables
    let R = 30;
    let I = 30;
    let C = 30;
    let fireDefense = 0;
    let earthDefense = 0;
    let airDefense = 0;
    let waterDefense = 0;
    
    function renderCard(card) {
        const cardsContainer = document.getElementById('card-container');
        cardsContainer.innerHTML = ''; // Clear previous card

        // Create a container for card content
        const cardContent = document.createElement('div');
        cardContent.id = 'card-content';
        cardContent.innerHTML = `
            <p>${card.name}</p>
        `;
        cardsContainer.appendChild(cardContent);

        // Create a container for buttons
        const buttonContainer = document.createElement('div');
        buttonContainer.id = 'button-container';
        buttonContainer.innerHTML = `
            <button class="action-button" onclick="handleCardChoice('yes')">Oui</button>
            <button class="action-button" onclick="handleCardChoice('no')">Non</button>
        `;
        cardsContainer.appendChild(buttonContainer);

        // Update UI elements
        updateUI();
    }

    function handleCardChoice(choice) {
        // Get the current card
        const currentCard = data.cards[currentCardIndex];

        console.log('Before choice:', { R, I, C, fireDefense, earthDefense, airDefense, waterDefense });

        // Apply effects based on the user's choice
        if (choice === 'yes') {
            R += currentCard.effect_yes_R;
            I += currentCard.effect_yes_I;
            C += currentCard.effect_yes_C;
            fireDefense = parseInt(fireDefense) + currentCard.fire_defense;
            earthDefense = parseInt(earthDefense) + currentCard.earth_defense;
            airDefense = parseInt(airDefense) + currentCard.air_defense;
            waterDefense = parseInt(waterDefense) + currentCard.water_defense;
        } else if (choice === 'no') {
            R += currentCard.effect_no_R;
            I += currentCard.effect_no_I;
            C += currentCard.effect_no_C;
        }

        console.log('After choice:', { R, I, C, fireDefense, earthDefense, airDefense, waterDefense });

        // Move to the next card
        currentCardIndex++;

        // Render the next card data
        if (currentCardIndex < data.cards.length) {
            renderCard(data.cards[currentCardIndex]);
        } else {
            // All cards have been displayed, you may want to handle this case
            console.log("All cards have been displayed");
        }

        // Update UI elements
        updateUI();
    }





function updateUI() {
    // Update gauge values
    document.getElementById('JaugeR').innerText = `Jauge R: ${R}`;
    document.getElementById('JaugeI').innerText = `Jauge I: ${I}`;
    document.getElementById('JaugeC').innerText = `Jauge C: ${C}`;

    // Update defense values
    const defenseFeu = parseInt(fireDefense);
    const defenseTerre = parseInt(earthDefense);
    const defenseAir = parseInt(airDefense);
    const defenseEau = parseInt(waterDefense);

    document.getElementsByClassName('additional-container')[0].innerText = `Défense feu: ${parseInt(defenseFeu)}`;
    document.getElementsByClassName('additional-container')[1].innerText = `Défense terre: ${parseInt(defenseTerre)}`;
    document.getElementsByClassName('additional-container')[2].innerText = `Défense air: ${parseInt(defenseAir)}`;
    document.getElementsByClassName('additional-container')[3].innerText = `Défense eau: ${parseInt(defenseEau)}`;
}



    let currentCardIndex = 0;
    let data;

    fetch('/api/cards')
        .then(response => response.json())
        .then(apidata => {
            data = apidata;
            renderCard(data.cards[currentCardIndex]);
        });
</script>


</body>
</html>

